#!/bin/bash

set -e

#
# Skip, if we are not in "configure" state
#
if [ "$1" != "configure" ]; then
    echo "I: Skipping configuration"
    exit 0
fi


#
#  If there is no volatile then add it.
#
if ( ! grep volatile /etc/apt/sources.list 2>/dev/null >/dev/null ); then
    cat >> /etc/apt/sources.list <<EOF

deb     http://mirror.bytemark.co.uk/debian-volatile/ lenny/volatile main contrib non-free
deb-src http://mirror.bytemark.co.uk/debian-volatile/ lenny/volatile main contrib non-free
EOF

else
  #
  # Make sure we change "stable/volatile" to "lenny/volatile"
  #
  sed -i -e 's#\<stable/volatile#lenny/volatile#g' /etc/apt/sources.list
fi


#
#  Update /etc/motd.
#
uname -snrvm > /etc/motd
cat >>/etc/motd<<EOF

To access the Bytemark Symbiosis documentation, please visit:

  * http://symbiosis.bytemark.co.uk/

EOF


#
#  Remove our obsolete vhost init script.
#
if [ -e /etc/init.d/bytemark-vhost ]; then
    update-rc.d -f bytemark-vhost remove
    rm /etc/init.d/bytemark-vhost
fi


#DEBHELPER#
exit 0
