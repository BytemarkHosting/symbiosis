####
##
#
# DO NOT EDIT THIS FILE - CHANGES WILL BE OVERWRITTEN
#
#  This file is automatically generated from the template located at
# /etc/symbiosis/apache.d/ssl.template.erb
#
#  If you absolutely MUST make changes, then please apply them to
# the master template file.  Then run the following command to
# make them live:
#
#   create-ssl-sites --force --verbose
#
##
###
##
#
#  For SSL documenation please consult:
#
#  http://symbiosis.bytemark.co.uk/docs/ch-ssl-hosting.html
#
##
###

NameVirtualHost <%= ip() %>:443

<VirtualHost <%= ip() %>:443>

        SSLEngine On
        SSLCertificateFile <%= certificate %>
        <% if key_file != certificate_file  %>
        SSLKeyFile <%= certificate %>
        <% end %>
        <% if certificate_chain_file %>
        SSLCertificateChainFile <%= bundle() %>
        <% end %>
        SSLOptions +StrictRequire


        #
        #  This is the directory people are redirected to
        # if their site is empty.
        #
        Alias /bytemark/ "/usr/share/symbiosis-static/"
        <Directory "/usr/share/symbiosis-static/">
                DirectoryIndex index.html
                AllowOverride None
        </Directory>

        #
        #  Allow users to override settings via .htaccess
        #
        <Directory "/srv">
                AllowOverride all
        </Directory>

        #
        #  And this makes that redirection happen.
        #
        <LocationMatch "^/+$">
                Options -Indexes
                ErrorDocument 403 /bytemark/
        </LocationMatch>

        #
        #  The document root
        #
        DocumentRoot     /srv/<%= @domain %>/public/htdocs/

        #
        # General CGI Handling
        #
        ScriptAlias /cgi-bin/ /srv/<%= @domain %>/public/cgi-bin/
        <Location /cgi-bin>
                Options +ExecCGI
        </Location>



        #
        #  We need to log the virtual hostname the incoming request was
        # made against, so that the cron-job in /etc/cron.daily may generate
        # statistics for each domain.
        #
        ErrorLog   /var/log/apache2/<%= @domain %>.ssl.error.log
        CustomLog  /var/log/apache2/<%= @domain %>.ssl.access.log combined
</VirtualHost>



NameVirtualHost <%= ip() %>:80

<VirtualHost <%= ip() %>:80>

<% if mandatory_ssl? %>
        #
        #  All accesses redirect to the HTTPS version of
        # the site.
        #
        Redirect / https://<%= @domain %>/

<% else %>

        #
        #  This is the directory people are redirected to
        # if their site is empty.
        #
        Alias /bytemark/ "/usr/share/symbiosis-static/"
        <Directory "/usr/share/symbiosis-static/">
                DirectoryIndex index.html
                AllowOverride None
        </Directory>

        #
        #  Allow users to override settings via .htaccess
        #
        <Directory "/srv">
                AllowOverride all
        </Directory>

        #
        #  And this makes that redirection happen.
        #
        <LocationMatch "^/+$">
                Options -Indexes
                ErrorDocument 403 /bytemark/
        </LocationMatch>

        #
        #  The document root
        #
        DocumentRoot     /srv/<%= @domain %>/public/htdocs/

        #
        # General CGI Handling
        #
        ScriptAlias /cgi-bin/ /srv/<%= @domain %>/public/cgi-bin/
        <Location /cgi-bin>
                Options +ExecCGI
        </Location>



        #
        #  We need to log the virtual hostname the incoming request was
        # made against, so that the cron-job in /etc/cron.daily may generate
        # statistics for each domain.
        #
        ErrorLog   /var/log/apache2/<%= @domain %>.error.log
        CustomLog  /var/log/apache2/<%= @domain %>.access.log combined
<% end %>
</VirtualHost>

